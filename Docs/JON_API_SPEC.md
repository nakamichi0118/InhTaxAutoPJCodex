# JON API 仕様書

本ドキュメントでは、SOROBOCRの不動産情報取得機能で使用するJON APIの仕様と連携方法を説明します。

## 概要

JON API（Japan Online Notarization API）は、住所から位置情報・登記情報・路線価図等を取得するAPIサービスです。SOROBOCRでは名寄帳/固定資産評価証明書から抽出した土地・家屋情報をJON APIに連携し、追加情報を自動取得します。

## API依存関係

```
位置特定API (locating) ← 必須の前提
    │
    ├── 路線価図API (rosenka)
    │   └── 緯度・経度が必要
    │
    ├── 登記取得API (registration)
    │   └── v1_codeが必要
    │
    ├── 公図API (kozu)
    │   └── v1_codeが必要
    │
    ├── 地積測量図API (chiseki) ※土地のみ
    │   └── v1_codeが必要
    │
    └── 建物図面API (tatemono) ※家屋のみ
        └── v1_codeが必要
```

**重要**: 登記簿・路線価・図面を取得するには、必ず位置特定APIを先に実行する必要があります。

## UIでの連動動作

| ユーザー操作 | システム動作 |
|-------------|-------------|
| 登記簿・路線価・図面にチェック | 地図（位置特定）が自動でチェックされる |
| 地図のチェックを外そうとする | 他にチェックがあれば警告を表示し、チェックを戻す |

## 取得オプション一覧

| オプション | 対象 | 説明 |
|-----------|------|------|
| 地図 | 土地・家屋 | 位置特定API。Googleマップリンクを生成 |
| 登記簿 | 土地・家屋 | 登記情報PDF取得（認証情報必要） |
| 路線価 | 土地のみ | 路線価図画像取得 |
| 図面 | 土地→地積測量図、家屋→建物図面 | 各種図面取得（認証情報必要） |

## 路線価図と倍率表

### 路線価地域と倍率地域

- **路線価地域**: 市街地など、道路に路線価が設定されている地域
- **倍率地域**: 農村部など、路線価がなく固定資産税評価額に倍率を乗じて評価する地域

### 結果表示ロジック

| JON API結果 | 表示内容 |
|-------------|----------|
| 路線価図が取得できた | `[路線価図]` ボタン + `[国税庁で確認]` リンク |
| 路線価図が取得できなかった | `[〇〇の倍率表]` リンク（都道府県レベル） |

### 国税庁リンクURL

路線価図・倍率表は国税庁の以下のURLで確認できます:

```
https://www.rosenka.nta.go.jp/main_r07/{都道府県コード}/
```

例:
- 大阪府: `https://www.rosenka.nta.go.jp/main_r07/osaka/`
- 東京都: `https://www.rosenka.nta.go.jp/main_r07/tokyo/`

## 環境変数設定

JON APIを使用するには、以下の環境変数を設定します:

```env
# JON API認証情報
JON_CLIENT_ID=your_client_id
JON_CLIENT_SECRET=your_client_secret
JON_API_BASE_URL=https://jon-api.com/api/v1

# 登記情報取得用（オプション）
TOUKI_LOGIN_ID=your_login_id
TOUKI_PASSWORD=your_password
```

## API制限事項

- トライアル制限: 各API 100回まで
- PDF URL有効期限: 7日間
- 登記解析: status 10001-10163はリトライ必要

## エラーハンドリング

| エラーコード | 説明 | 対処 |
|-------------|------|------|
| 位置特定失敗 | 住所が見つからない | 住所表記を確認・修正 |
| 路線価図なし | 倍率地域の可能性 | 倍率表リンクから確認 |
| 認証エラー | 認証情報が無効 | 環境変数を確認 |

---

更新日: 2026-01-27
