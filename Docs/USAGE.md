# SOROBOCR 使い方ガイド

本ガイドでは、SOROBOCR（InhTaxAutoPJ Codex）のWebアプリ/APIを用いて通帳・取引履歴を読み取る手順と、よくある質問をまとめています。最新のフローではGemini 2.5 Pro単体解析が標準となり、高精度なCSVを生成できます。

## 1. 準備

1. **推奨環境**: Google Chrome / Microsoft Edge 最新版。
2. **ファイル形式**: PDF（1口座ごとに1ファイルへまとめてください）。画像からPDFに変換する場合は 600dpi 程度でスキャンしてください。解像度が低すぎると読み取り精度が著しく低下します。
3. **WebアプリURL**: `webapp/index.html` をホスティングした環境、またはローカルで `file://` 直接開いて利用します。`?api=` クエリを指定することで接続先APIを切り替えられます。
4. **セキュリティ方針**: アップロードしたPDFはジョブ処理にのみ使用し、完了後に自動削除します。サーバーに長期保存されないため、必要なCSVをダウンロードして各自で保管してください。

## 2. 基本的な使い方

1. ブラウザで Webアプリを開きます。
2. 解析エンジンを選択します（デフォルト: Gemini 2.5 Pro 単体）。速度を優先する場合のみ Gemini 2.5 Flash へ切り替えてください。
3. 日付形式（西暦/和暦）を選択します。判別できない場合は `自動判定` のままで構いません。
4. 「PDFファイルを選択」から通帳PDFをアップロードするか、ドロップエリアにドラッグ＆ドロップして読み取りを開始します。
5. 読み取り完了後、結果タブでサマリ・処理時間・プレビューを確認できます。`CSVダウンロード` セクションから `bank_transactions.csv` などを保存してください。

## 3. 精度・速度の目安

| 解析モード | 精度 | 処理時間 | 備考 |
| --- | --- | --- | --- |
| Gemini 2.5 Pro 単体 | 約99% | ページ数に応じ数分〜10分 | 残高差を基準に入出金を補正。最も高精度で推奨。 |
| Gemini 2.5 Flash 単体 | 約95% | Proより短い | 高速だが誤読が増える場合あり。結果を必ず目視確認してください。 |

処理が長時間続く場合は、PDFが極端に大きい/ページ数が多い/解像度が低い可能性があります。Geminiモードは1ページずつ解析して進捗をUIに表示するため、途中で停止しているように見えても裏で処理しています。

## 4. よくある質問 (FAQ)

### Q1. 画質が悪いPDFは読み取れますか？
A. 推奨解像度は 600dpi です。文字が潰れている、濃淡が激しい場合は Gemini 2.5 Pro/Flash でも精度が落ちます。原本を再スキャンし、ノイズを抑えてください。

### Q2. 通帳の複数口座を1つのPDFにまとめても良いですか？
A. いいえ。1口座ごとにPDFを分けてください。合算記帳や途中で別口座が混ざる構成では残高が連続せず、補正ロジックが正常に働きません。

### Q3. アップロードしたPDFはサーバーに保存されますか？
A. 解析処理のために一時的に保存しますが、ジョブの完了後に自動削除します。サーバー側に履歴を残さないため、必要なCSVはダウンロードして保管してください。

### Q4. PDF以外（画像、Excelなど）はアップロードできますか？
A. 対応していません。紙の通帳は600dpi程度でスキャンしてPDF化し、必ずページ順を整えてからアップロードしてください。

## 5. トラブルシューティング

1. **タイムアウトする**: Geminiリクエストがタイムアウトした場合、自動的に小さなチャンクで再試行します。長時間待っても完了しないときは PDF を分割・圧縮し直してください。
2. **通帳のページ順が入れ替わっている**: ページ順を正しい時系列に並べ替えてからアップロードしてください。
3. **結果のCSVが空**: 解析対象が認識されていない可能性があります。通帳以外の書式（手書きメモなど）は未対応です。

---
このガイドは `docs/USAGE.md` としてリポジトリに含まれます。運用中に追加のFAQがあれば更新してください。
