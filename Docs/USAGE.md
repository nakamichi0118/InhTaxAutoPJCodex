# SOROBOCR 使い方ガイド

本ガイドでは、SOROBOCR（InhTaxAutoPJ Codex）のWebアプリ/APIを用いて通帳・取引履歴を読み取る手順と、よくある質問をまとめています。最新のフローではGemini 2.5 Pro単体解析が標準となり、高精度なCSVを生成できます。

## 1. 準備

1. **推奨環境**: Google Chrome / Microsoft Edge 最新版。
2. **対応ファイル**: PDFのみ（1口座=1ファイル）。画像を使う場合は600dpi程度でPDF化し、ページ順を整えてください。
3. **WebアプリURL**: `webapp/index.html` をホスティングした環境、またはローカルで `file://` 直接開いて利用します。`?api=` クエリを指定することで接続先APIを切り替えられます。
4. **セキュリティ方針**: アップロードしたPDFはジョブ処理にのみ使用し、完了後に自動削除します。サーバーに長期保存されないため、必要なCSVをダウンロードして各自で保管してください。

## 2. 基本的な使い方

1. ブラウザで Webアプリを開きます。
2. 解析エンジンを選択します（標準: Gemini 2.5 Pro）。速度を優先したい場合のみ Gemini 2.5 Flash に切り替えてください。
3. 日付形式（西暦/和暦）を選択します。判別できない場合は `自動判定` のままで構いません。
4. 「PDFファイルを選択」から通帳PDFをアップロードするか、ドロップエリアにドラッグ＆ドロップして読み取りを開始します。
5. 読み取り完了後、結果タブでサマリ・処理時間・プレビューを確認できます。`CSVダウンロード` セクションから `bank_transactions.csv` などを保存してください。

## 3. 精度・速度の目安

| 解析モード | 精度 | 処理時間 | 備考 |
| --- | --- | --- | --- |
| Gemini 2.5 Pro 単体 | 約99% | ページ数に応じ数分〜10分 | 残高差を基準に入出金を補正。最も高精度で推奨。 |
| Gemini 2.5 Flash 単体 | 約95% | Proより短い | 高速だが誤読が増える場合あり。結果を必ず目視確認してください。 |

処理が長時間続く場合は、PDFが極端に大きい/ページ数が多い/解像度が低い可能性があります。Geminiモードは1ページずつ解析して進捗をUIに表示するため、途中で停止しているように見えても裏で処理しています。

## 4. よくある質問 (FAQ)

### Q1. 画像が横向きでも読み取れますか？
A. はい。向きは自動で補正されるので、そのままアップロードして構いません。

### Q2. 読み取りにはどれくらい時間がかかりますか？
A. おおむね1行あたり0.6〜1.8秒です。100取引であれば1〜3分ほどお待ちください。

### Q3. 読み取りが遅い・完了しない場合は？
A. 「PDFのページ数・ファイルサイズが大きい」「通信が不安定」「サーバーが混雑している」可能性があります。ページを再読み込みして再アップロードすると解消するケースが多いです。

### Q4. PDFのアップロード上限や枚数の上限は？
A. 1ファイルあたり約20MB／100ページが目安です。複数PDFを一度に追加できますが、全体が大きい場合は数回に分けてください。

### Q5. 銀行によって精度に差はありますか？
A. ゆうちょや都市銀行など一般的な明細は約99%の精度です。独自フォーマットや潰れた文字が多いPDFでは誤認識が起きることがあります。

### Q6. データはどこに保存されますか？安全ですか？
A. アップロードされたPDFは処理後すぐ破棄されます。取引結果はブラウザ経由でのみダウンロードされ、サーバーには保存されません。

## 5. トラブルシューティング

1. **タイムアウトする**: Geminiリクエストがタイムアウトした場合、自動的に小さなチャンクで再試行します。長時間待っても完了しないときは PDF を分割・圧縮し直してください。
2. **通帳のページ順が入れ替わっている**: ページ順を正しい時系列に並べ替えてからアップロードしてください。
3. **結果のCSVが空**: 解析対象が認識されていない可能性があります。通帳以外の書式（手書きメモなど）は未対応です。

---
このガイドは `docs/USAGE.md` としてリポジトリに含まれます。運用中に追加のFAQがあれば更新してください。
